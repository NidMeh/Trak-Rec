<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trak Recovery</title>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #0d0d0d;
    color: #f5f5f5;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  header {
    padding: 20px;
    font-size: 1.5em;
    font-weight: bold;
    background-color: #111;
    border-bottom: 1px solid #222;
  }
  nav {
    display: flex;
    justify-content: space-around;
    background-color: #111;
    padding: 10px 0;
    position: sticky;
    bottom: 0;
  }
  nav button {
    background: none;
    border: none;
    color: #888;
    font-size: 1em;
    cursor: pointer;
  }
  nav button.active {
    color: #4cafef;
  }
  .page {
    display: none;
    padding: 20px;
  }
  .active-page {
    display: block;
  }
  .stat {
    margin: 15px 0;
    font-size: 1.2em;
  }
  button {
    padding: 12px 18px;
    margin: 8px;
    background-color: #1f1f1f;
    border: none;
    color: white;
    font-size: 1em;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background-color: #333;
  }
  .xp-bar {
    width: 80%;
    background-color: #222;
    border-radius: 10px;
    margin: 10px auto;
    height: 20px;
    overflow: hidden;
  }
  .xp-fill {
    height: 100%;
    background-color: #4cafef;
    width: 0%;
    transition: width 0.4s;
  }
  textarea {
    width: 80%;
    padding: 8px;
    margin: 10px 0;
    background: #111;
    border: 1px solid #333;
    color: white;
    border-radius: 5px;
  }
  .milestone {
    background: #111;
    border: 1px solid #333;
    padding: 10px;
    border-radius: 8px;
    margin: 8px 0;
    text-align: left;
  }
  .milestone.reached {
    border-color: #4cafef;
    background: #0a1a26;
  }
</style>
</head>
<body>

<header>Trak Recovery</header>

<!-- HOME -->
<div id="home" class="page active-page">
  <div class="stat">Current Streak: <span id="streak">0</span> days</div>
  <div class="stat">Highest Streak: <span id="highStreak">0</span> days</div>
  <div class="stat">Level: <span id="level">1</span></div>
  <div class="stat">XP: <span id="xp">0</span> / <span id="xpGoal">100</span></div>

  <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>

  <button onclick="addDay()">Add Day</button>
  <button onclick="resetStreak()">Log Relapse</button>
</div>

<!-- MILESTONES -->
<div id="milestones" class="page">
  <h3>Milestone Roadmap</h3>
  <div id="milestoneList"></div>
</div>

<!-- JOURNAL -->
<div id="journal" class="page">
  <h3>Daily Journal</h3>
  <textarea id="journalInput" placeholder="How was your day?"></textarea><br>
  <button onclick="saveJournal()">Save Entry</button>
  <h4>Past Entries</h4>
  <div id="journalLog"></div>
</div>

<!-- URGE TIMER -->
<div id="urge" class="page">
  <h3>Urge Timer</h3>
  <div class="stat">Urge Duration: <span id="urgeTime">0</span> seconds</div>
  <button onclick="startUrge()">Start</button>
  <button onclick="stopUrge()">Stop</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="page">
  <h3>Settings</h3>
  <button onclick="resetApp()" style="background-color: red;">Reset App</button>
</div>

<!-- NAVIGATION -->
<nav>
  <button onclick="showPage('home')" class="active">Home</button>
  <button onclick="showPage('milestones')">Milestones</button>
  <button onclick="showPage('journal')">Journal</button>
  <button onclick="showPage('urge')">Urge</button>
  <button onclick="showPage('settings')">Settings</button>
</nav>

<script>
  // Recovery stats
  let streak = parseInt(localStorage.getItem('streak')) || 0;
  let highStreak = parseInt(localStorage.getItem('highStreak')) || 0;
  let xp = parseInt(localStorage.getItem('xp')) || 0;
  let xpGoal = parseInt(localStorage.getItem('xpGoal')) || 100;
  let level = parseInt(localStorage.getItem('level')) || 1;

  // Milestones
  const milestones = [
    { days: 1, title: "Commitment Made", desc: "You’ve taken the first step." },
    { days: 7, title: "Urges Lower", desc: "Brain starting to adapt." },
    { days: 14, title: "Energy Boost", desc: "Small surge of motivation." },
    { days: 21, title: "Sleep Stabilizing", desc: "Better rest & recovery." },
    { days: 30, title: "Mood Lift", desc: "Noticeable improvement in mood." },
    { days: 60, title: "Sensitivity Returning", desc: "Small signs of physical healing." },
    { days: 90, title: "Self Control Stronger", desc: "Resisting urges feels easier." },
    { days: 120, title: "Urges Manageable", desc: "Little control feels like second nature." },
    { days: 180, title: "Near Full Sensitivity", desc: "Your body is healing well." },
    { days: 240, title: "Brain Fog Clearing", desc: "Sharper focus daily." },
    { days: 365, title: "1 Year Milestone", desc: "Full mental reset achieved." }
  ];

  // Urge timer
  let urgeStartTime = null;

  // Load data into UI
  updateUI();
  renderMilestones();
  loadJournalLog();

  function updateUI() {
    document.getElementById('streak').textContent = streak;
    document.getElementById('highStreak').textContent = highStreak;
    document.getElementById('xp').textContent = xp;
    document.getElementById('xpGoal').textContent = xpGoal;
    document.getElementById('level').textContent = level;
    document.getElementById('xpFill').style.width = (xp / xpGoal) * 100 + '%';
  }

  function addDay() {
    streak++;
    xp += 10;
    if (xp >= xpGoal) {
      xp = 0;
      level++;
      xpGoal += 50;
      alert("🎉 Level Up! You are now Level " + level);
    }
    if (streak > highStreak) highStreak = streak;
    checkMilestones();
    saveStats();
  }

  function resetStreak() {
    streak = 0;
    saveStats();
  }

  function saveStats() {
    localStorage.setItem('streak', streak);
    localStorage.setItem('highStreak', highStreak);
    localStorage.setItem('xp', xp);
    localStorage.setItem('xpGoal', xpGoal);
    localStorage.setItem('level', level);
    updateUI();
  }

  function checkMilestones() {
    milestones.forEach(m => {
      if (streak === m.days) {
        alert(`🏆 Milestone reached: ${m.title}\n${m.desc}`);
      }
    });
    renderMilestones();
  }

  function renderMilestones() {
    const list = document.getElementById('milestoneList');
    list.innerHTML = '';
    milestones.forEach(m => {
      const div = document.createElement('div');
      div.className = 'milestone' + (streak >= m.days ? ' reached' : '');
      div.innerHTML = `<strong>Day ${m.days}:</strong> ${m.title}<br><small>${m.desc}</small>`;
      list.appendChild(div);
    });
  }

  // Journal
  function saveJournal() {
    let text = document.getElementById('journalInput').value;
    let date = new Date().toLocaleDateString();
    localStorage.setItem('journal-' + date, text);
    document.getElementById('journalInput').value = '';
    loadJournalLog();
  }

  function loadJournalLog() {
    const log = document.getElementById('journalLog');
    log.innerHTML = '';
    Object.keys(localStorage).forEach(key => {
      if (key.startsWith('journal-')) {
        const entry = document.createElement('div');
        entry.style.borderBottom = '1px solid #333';
        entry.style.padding = '5px 0';
        entry.innerHTML = `<strong>${key.replace('journal-', '')}</strong>: ${localStorage.getItem(key)}`;
        log.appendChild(entry);
      }
    });
  }

  // Urge Timer
  function startUrge() {
    urgeStartTime = Date.now();
  }
  function stopUrge() {
    if (urgeStartTime) {
      let duration = Math.floor((Date.now() - urgeStartTime) / 1000);
      document.getElementById('urgeTime').textContent = duration;
      alert("You survived an urge for " + duration + " seconds!");
      urgeStartTime = null;
    }
  }

  // Reset App
  function resetApp() {
    if (confirm("Are you sure you want to reset everything?")) {
      localStorage.clear();
      streak = 0;
      highStreak = 0;
      xp = 0;
      xpGoal = 100;
      level = 1;
      updateUI();
      renderMilestones();
      loadJournalLog();
    }
  }

  // Navigation
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
    document.getElementById(id).classList.add('active-page');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.querySelector(`nav button[onclick="showPage('${id}')"]`).classList.add('active');
  }
</script>

</body>
</html>
